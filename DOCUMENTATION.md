# 🐾 宠物综合体经营测算应用 - 技术文档

## 项目概述

宠物综合体经营测算应用是一个专业的财务建模工具，专门为宠物行业的投资决策、物业谈判和路演展示而设计。该应用采用模块化架构，提供完整的财务分析功能，包括四大收入板块测算、成本分析和投资回报计算。

### 核心特性

- **四大收入板块**: 会员收入、寄养收入、医疗收入、零售/餐饮/社交收入
- **实时财务计算**: 基于参数变化的即时计算和更新
- **模块化架构**: 清晰的代码组织和组件分离
- **响应式设计**: 支持桌面和移动设备
- **数据持久化**: 本地存储用户输入参数

## 技术架构

### 技术栈

- **前端框架**: React 17 (通过 CDN 加载)
- **UI 组件库**: Ant Design 5.12.8 (通过 CDN 加载) 
- **样式系统**: Tailwind CSS 2.2.19 (通过 CDN 加载)
- **构建工具**: Babel Standalone (浏览器内 JSX 转译)
- **数据持久化**: 浏览器 localStorage
- **运行环境**: 纯前端应用，无需后端服务器

### 文件结构

```
/
├── index.html                    # 原始单文件应用
├── index_v2.html                 # 模块化版本主入口
├── app.js                        # 主应用文件
├── app.jsx                       # JSX 版本（已合并到 index.html）
├── initial.jsx                   # 简化参考版本
├── CLAUDE.md                     # 项目配置文档
├── README.md                     # 使用说明
└── js/                           # 模块化组件目录
    ├── core/                     # 核心模块
    │   ├── calculator.js         # 计算引擎
    │   ├── data-manager.js       # 数据管理器
    │   └── formula-engine.js     # 公式引擎
    ├── components/               # UI 组件
    │   ├── ui-components.js      # 基础 UI 组件
    │   ├── ui-components-antd.js # Ant Design 组件封装
    │   ├── formula-display.js    # 公式显示组件
    │   └── chart-components.js   # 图表组件
    ├── pages/                    # 页面组件
    │   ├── overview-page.js      # 概览页面
    │   ├── settings-page.js      # 设置页面
    │   └── analysis-page.js      # 分析页面
    └── modules/                  # 业务模块
        ├── scenario-analysis.js  # 情景分析
        ├── breakeven-analysis.js # 盈亏平衡分析
        └── custom-modules.js     # 自定义模块
```

## 核心模块详解

### 1. 主应用模块 (app.js)

主应用文件包含应用的核心逻辑和状态管理：

**主要功能**:
- React 状态管理 (数据、计算结果、页签状态)
- 数据管理器、公式引擎和计算器的初始化
- 页面路由和组件渲染
- 错误边界处理

**关键状态**:
```javascript
const [data, setData] = React.useState(null);           // 业务数据
const [calculations, setCalculations] = React.useState(null); // 计算结果
const [activeTab, setActiveTab] = React.useState('overview'); // 当前页签
const [isLoading, setIsLoading] = React.useState(true);      // 加载状态
const [error, setError] = React.useState(null);             // 错误状态
```

### 2. 核心计算模块

#### 2.1 计算引擎 (calculator.js)
负责所有财务计算逻辑：

- **收入计算**: 四大板块收入的详细计算
- **成本计算**: 固定成本和变动成本分析  
- **利润分析**: 年度利润、利润率、回本周期
- **敏感性分析**: 关键参数变化对收益的影响

#### 2.2 公式引擎 (formula-engine.js)
管理计算公式和表达式：

- **公式定义**: 标准化的计算公式
- **表达式解析**: 动态公式计算
- **依赖管理**: 公式间的依赖关系处理

#### 2.3 数据管理器 (data-manager.js)
处理数据持久化和状态管理：

- **数据加载**: 从 localStorage 加载保存的数据
- **数据保存**: 实时保存用户输入
- **数据验证**: 输入数据的合法性检查
- **预设数据**: 示例参数的管理

### 3. UI 组件系统

#### 3.1 基础组件 (ui-components.js)
通用 UI 组件库：

- **NumberInput**: 数值输入组件，支持格式化和验证
- **Section**: 参数分组容器
- **Tabs**: 页签导航组件
- **KPI**: 关键指标显示组件

#### 3.2 Ant Design 封装 (ui-components-antd.js)
Ant Design 组件的自定义封装：

- **主题配置**: 统一的设计主题
- **本地化**: 中文界面支持
- **组件扩展**: 基于 Ant Design 的定制组件

### 4. 页面组件

#### 4.1 概览页面 (overview-page.js)
显示核心财务指标和经营概况：

- **关键指标**: 总营收、总成本、年度利润
- **收入分解**: 四大板块收入明细
- **可视化图表**: 收入结构饼图、趋势图

#### 4.2 设置页面 (settings-page.js)
参数配置和输入界面：

- **基础参数**: 面积、租金、人员配置
- **业务参数**: 各板块的详细经营参数
- **预设参数**: 一键套用示例数据

#### 4.3 分析页面 (analysis-page.js)
深度财务分析功能：

- **情景分析**: 不同经营情景下的财务表现
- **敏感性分析**: 关键参数变化的影响分析
- **盈亏平衡**: 盈亏平衡点计算和分析

## 财务模型详解

### 收入模型

#### 1. 会员收入
```
会员收入 = 基础会员数 × 基础会员费 + 高级会员数 × 高级会员费
```

#### 2. 寄养收入
```
寄养收入 = 房间数 × 平均房价 × 入住率 × 365天
```

#### 3. 医疗收入
```
医疗收入 = 诊疗收入 + 增值服务收入 + 医疗产品销售收入
```

#### 4. 零售/餐饮/社交收入
```
其他收入 = 零售收入 + 餐饮收入 + 社交活动收入
```

### 成本模型

#### 固定成本
- 租金成本: 面积 × 租金单价 × 12个月
- 人力成本: 员工数 × 平均薪资 × 12个月
- 物业管理费: 面积 × 物业费 × 12个月

#### 变动成本
- 按各业务板块收入的特定比例计算
- 支持动态调整成本率

### 关键指标计算

```javascript
// 年度利润
年度利润 = 总营收 - 总成本

// 利润率
利润率 = (年度利润 / 总营收) × 100%

// 回本周期
回本周期 = 初始投资 / 年度利润
```

## 开发指南

### 本地开发环境

1. **直接运行**:
```bash
# 在浏览器中打开
open index_v2.html
```

2. **本地服务器**:
```bash
# 使用 Python
python -m http.server 8000

# 使用 Node.js
npx serve .
```

### 添加新功能

#### 1. 添加新的计算指标

1. 在 `calculator.js` 中添加计算逻辑
2. 在相关页面组件中添加显示逻辑
3. 更新数据管理器的保存逻辑

#### 2. 添加新的页面

1. 在 `js/pages/` 目录创建新页面文件
2. 在主应用的 `tabs` 配置中添加页签
3. 在主渲染逻辑中添加页面组件

#### 3. 添加新的UI组件

1. 在 `ui-components.js` 中定义新组件
2. 遵循现有的设计系统和命名规范
3. 确保组件的可复用性

### 代码规范

#### JavaScript 规范
- 使用现代 ES6+ 语法
- 遵循 React Hooks 最佳实践
- 保持组件的纯函数特性
- 使用有意义的变量和函数命名

#### 样式规范
- 使用 Tailwind CSS 工具类
- 保持响应式设计
- 遵循统一的颜色和间距规范

#### 文件组织
- 按功能模块组织文件
- 保持单一职责原则
- 使用清晰的文件命名

## 部署和运维

### 部署方式

**静态文件托管**:
- 所有文件都是静态资源
- 可部署到任何静态文件服务器
- 支持 GitHub Pages、Netlify、Vercel 等平台

**本地部署**:
- 无需安装依赖
- 直接在浏览器中运行
- 支持离线使用（需本地化 CDN 资源）

### 性能优化

1. **CDN 资源**:
   - React、Ant Design、Tailwind 等通过 CDN 加载
   - 利用浏览器缓存提高加载速度

2. **模块化加载**:
   - 按需加载各功能模块
   - 减少首次加载时间

3. **数据缓存**:
   - 使用 localStorage 缓存用户数据
   - 避免重复计算

### 浏览器兼容性

- **推荐浏览器**: Chrome 80+, Firefox 75+, Safari 13+
- **移动端**: iOS Safari 13+, Android Chrome 80+
- **必要特性**: ES6+, localStorage, CSS Grid

## 故障排除

### 常见问题

1. **模块加载失败**:
   - 检查 CDN 资源是否可访问
   - 确保网络连接正常

2. **数据丢失**:
   - 检查 localStorage 是否被清除
   - 验证浏览器隐私设置

3. **计算错误**:
   - 检查输入参数的有效性
   - 验证计算公式逻辑

4. **显示异常**:
   - 检查浏览器控制台错误信息
   - 确保组件依赖正确加载

### 调试工具

1. **浏览器开发者工具**:
   - Console: 查看错误信息和调试输出
   - Network: 检查资源加载状态
   - Application: 查看 localStorage 数据

2. **React 调试**:
   - 使用 React Developer Tools 扩展
   - 检查组件状态和 props

## 更新日志

### v2.0 (当前版本)
- ✅ 模块化架构重构
- ✅ Ant Design UI 组件集成
- ✅ 增强的财务分析功能
- ✅ 响应式设计优化
- ✅ 错误处理和边界保护

### v1.0
- 基础财务计算功能
- 单文件应用结构
- 基础参数配置

## 贡献指南

### 开发流程

1. **Fork 项目**
2. **创建功能分支**
3. **提交代码变更**
4. **测试功能**
5. **提交 Pull Request**

### 代码审查

- 确保代码符合项目规范
- 添加必要的注释和文档
- 验证功能的正确性
- 检查性能影响

## 联系方式

如需技术支持或功能建议，请通过以下方式联系：

- **GitHub Issues**: 提交 bug 报告和功能请求
- **文档更新**: 通过 Pull Request 提交文档改进

---

*最后更新: 2024年*
*文档版本: v2.0*